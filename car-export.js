import * as IPFS from "ipfs";
import * as uint8arrays from "uint8arrays";
import { CID } from "multiformats/cid";
import { Readable } from "stream";
import * as fs from "fs";

const AlsoKnownAs =
  "a36464617461a76474797065666f626a656374657469746c656b416c736f4b6e6f776e41736724736368656d617827687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d612368726571756972656481686163636f756e74736a70726f70657274696573a1686163636f756e7473a26474797065656172726179656974656d73a1642472656675232f646566696e6974696f6e732f4163636f756e746b646566696e6974696f6e73a2674163636f756e74a36474797065666f626a656374687265717569726564826870726f746f636f6c6269646a70726f70657274696573a5626964a2647479706566737472696e67696d61784c656e6774681901c264686f7374a2647479706566737472696e67696d61784c656e677468189665636c61696da2647479706566737472696e67696d61784c656e6774681901c26870726f746f636f6ca2647479706566737472696e67696d61784c656e67746818326c6174746573746174696f6e73a26474797065656172726179656974656d73a164247265667819232f646566696e6974696f6e732f4174746573746174696f6e6b4174746573746174696f6ea26474797065666f626a6563746a70726f70657274696573a2676469642d6a7774a2647479706566737472696e67696d61784c656e6774681903e86a6469642d6a77742d7663a2647479706566737472696e67696d61784c656e6774681903e8746164646974696f6e616c50726f70657274696573f466686561646572a266736368656d61f76b636f6e74726f6c6c6572738178386469643a6b65793a7a364d6b734e59453657744d5a33574c625077637039476d376454374a3344734e50386175514e6e507051427533374167646f63747970656474696c65";
const BasicProfile =
  "a36464617461a56474797065666f626a656374657469746c656c426173696350726f66696c656724736368656d617827687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d61236a70726f70657274696573ac6375726ca2647479706566737472696e67696d61784c656e67746818f0646e616d65a2647479706566737472696e67696d61784c656e677468189665656d6f6a69a2647479706566737472696e67696d61784c656e6774680265696d616765a16424726566781a232f646566696e6974696f6e732f696d616765536f75726365736667656e646572a2647479706566737472696e67696d61784c656e677468182a69626972746844617465a3647479706566737472696e6766666f726d61746464617465696d61784c656e6774680a6a6261636b67726f756e64a16424726566781a232f646566696e6974696f6e732f696d616765536f75726365736b6465736372697074696f6ea2647479706566737472696e67696d61784c656e6774681901a46c616666696c696174696f6e73a26474797065656172726179656974656d73a2647479706566737472696e67696d61784c656e677468188c6c686f6d654c6f636174696f6ea2647479706566737472696e67696d61784c656e677468188c6d6e6174696f6e616c6974696573a36474797065656172726179656974656d73a3647479706566737472696e67677061747465726e6a5e5b412d5a5d7b327d24686d61784974656d7305686d696e4974656d7301707265736964656e6365436f756e747279a3647479706566737472696e67677061747465726e6a5e5b412d5a5d7b327d24696d61784c656e677468026b646566696e6974696f6e73a4674950465355726ca3647479706566737472696e67677061747465726e6a5e697066733a2f2f2e2b696d61784c656e67746818966c696d616765536f7572636573a36474797065666f626a65637468726571756972656481686f726967696e616c6a70726f70657274696573a2686f726967696e616ca16424726566781b232f646566696e6974696f6e732f696d6167654d657461646174616c616c7465726e617469766573a26474797065656172726179656974656d73a16424726566781b232f646566696e6974696f6e732f696d6167654d657461646174616d696d6167654d65746164617461a36474797065666f626a6563746872657175697265648463737263686d696d6554797065657769647468666865696768746a70726f70657274696573a563737263a1642472656675232f646566696e6974696f6e732f4950465355726c6473697a65a16424726566781d232f646566696e6974696f6e732f706f736974697665496e7465676572657769647468a16424726566781d232f646566696e6974696f6e732f706f736974697665496e746567657266686569676874a16424726566781d232f646566696e6974696f6e732f706f736974697665496e7465676572686d696d6554797065a2647479706566737472696e67696d61784c656e67746818326f706f736974697665496e7465676572a2647479706567696e7465676572676d696e696d756d0166686561646572a266736368656d61f76b636f6e74726f6c6c6572738178386469643a6b65793a7a364d6b734e59453657744d5a33574c625077637039476d376454374a3344734e50386175514e6e507051427533374167646f63747970656474696c65";
const CryptoAccounts =
  "a36464617461a66474797065666f626a656374657469746c657243727970746f4163636f756e744c696e6b736724736368656d617827687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d61236d70726f70657274794e616d6573a1696d61784c656e677468190400717061747465726e50726f70657274696573a178385e5b612d7a412d5a302d395d7b312c36337d405b2d612d7a412d5a302d395d7b332c31367d3a5b2d612d7a412d5a302d395d7b312c34377da3647479706566737472696e67677061747465726e6d5e636572616d69633a2f2f2e2b696d61784c656e677468190400746164646974696f6e616c50726f70657274696573f466686561646572a266736368656d61f76b636f6e74726f6c6c6572738178386469643a6b65793a7a364d6b734e59453657744d5a33574c625077637039476d376454374a3344734e50386175514e6e507051427533374167646f63747970656474696c65";
const Definition =
  "a36464617461a66474797065666f626a656374657469746c656a446566696e6974696f6e6724736368656d617827687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d612368726571756972656483646e616d656b6465736372697074696f6e66736368656d616a70726f70657274696573a56375726ca2647479706566737472696e67696d61784c656e67746818f0646e616d65a2647479706566737472696e67696d61784c656e677468189666636f6e666967a16474797065666f626a65637466736368656d61a16424726566781a232f646566696e6974696f6e732f436572616d6963446f6349646b6465736372697074696f6ea2647479706566737472696e67696d61784c656e6774681901a46b646566696e6974696f6e73a16c436572616d6963446f634964a3647479706566737472696e67677061747465726e781c5e636572616d69633a2f2f2e2b285c3f76657273696f6e3d2e2b293f696d61784c656e677468189666686561646572a266736368656d61f76b636f6e74726f6c6c6572738178386469643a6b65793a7a364d6b734e59453657744d5a33574c625077637039476d376454374a3344734e50386175514e6e507051427533374167646f63747970656474696c65";
const IdentityIndex =
  "a36464617461a56474797065666f626a656374657469746c656d4964656e74697479496e6465786724736368656d617827687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d61236b646566696e6974696f6e73a16c436572616d6963446f634964a3647479706566737472696e67677061747465726e781c5e636572616d69633a2f2f2e2b285c3f76657273696f6e3d2e2b293f696d61784c656e6774681896746164646974696f6e616c50726f70657274696573a16424726566781a232f646566696e6974696f6e732f436572616d6963446f63496466686561646572a266736368656d61f76b636f6e74726f6c6c6572738178386469643a6b65793a7a364d6b734e59453657744d5a33574c625077637039476d376454374a3344734e50386175514e6e507051427533374167646f63747970656474696c65";
const ThreeIdKeychain =
  "a36464617461a56474797065666f626a6563746724736368656d617827687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d61236a70726f70657274696573a267617574684d6170a26474797065666f626a656374746164646974696f6e616c50726f70657274696573a1642472656676232f646566696e6974696f6e732f417574684461746169706173745365656473a26474797065656172726179656974656d73a1642472656671232f646566696e6974696f6e732f4a57456b646566696e6974696f6e73a3634a5745a46474797065666f626a656374657469746c65634a5745687265717569726564846970726f7465637465646269766a63697068657274657874637461676a70726f70657274696573a6626976a1647479706566737472696e6763616164a1647479706566737472696e6763746167a1647479706566737472696e676970726f746563746564a1647479706566737472696e676a63697068657274657874a1647479706566737472696e676a726563697069656e7473a26474797065656172726179656974656d73a36474797065666f626a65637468726571756972656482666865616465726d656e637279707465645f6b65796a70726f70657274696573a266686561646572a16474797065666f626a6563746d656e637279707465645f6b6579a1647479706566737472696e67684175746844617461a36474797065666f626a6563746a70726f70657274696573a3626964a164247265667818232f646566696e6974696f6e732f577261707065644a574563707562a1647479706566737472696e676464617461a164247265667818232f646566696e6974696f6e732f577261707065644a5745746164646974696f6e616c50726f70657274696573f46a577261707065644a5745a36474797065666f626a6563746a70726f70657274696573a1636a7765a1642472656671232f646566696e6974696f6e732f4a5745746164646974696f6e616c50726f70657274696573f4746164646974696f6e616c50726f70657274696573f466686561646572a266736368656d61f76b636f6e74726f6c6c6572738178386469643a6b65793a7a364d6b734e59453657744d5a33574c625077637039476d376454374a3344734e50386175514e6e507051427533374167646f63747970656474696c65";
const blockHex = [
  AlsoKnownAs,
  BasicProfile,
  CryptoAccounts,
  Definition,
  IdentityIndex,
  ThreeIdKeychain,
];
const blockBytes = blockHex.map((hex) => uint8arrays.fromString(hex, "base16"));

async function main() {
  const ipfs = await IPFS.create();
  const bytes = uint8arrays.fromString(AlsoKnownAs, "base16");
  const cid = await ipfs.block.put(bytes, { format: "dag-cbor", version: 1 });
  console.log("cid", cid);
  const out = ipfs.dag.export(cid);
  const ai = out[Symbol.asyncIterator]()
  console.log('0', await ai.next())
    console.log('1', await ai.next())
  // Readable.from(out).pipe(fs.createWriteStream(`${cid}.car`));
  // await Promise.all(blockBytes.map(async bytes => {
  //     const cid = await ipfs.block.put(bytes, {format: 'dag-cbor', version: 1})
  //     console.log('cid', cid)
  //     const out = await ipfs.dag.export(cid)
  //     Readable.from(out).pipe(fs.createWriteStream(`${cid}.car`))
  // }))
}

main();
